<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/icons/favicon-16x16.png">
    <link rel="manifest" href="/assets/icons/site.webmanifest">
    <link rel="shortcut icon" href="/assets/icons/favicon.ico">
    <title>주변 맛집 전체보기 - Bapick</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fill-1 {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>

<body class="bg-slate-100">

    <header class="sticky top-0 bg-white shadow-sm z-20">
        <div class="max-w-md mx-auto flex items-center justify-between h-16 px-4">
            <a href="javascript:history.back()" class="p-2 -ml-2">
                <span class="material-symbols-outlined">arrow_back_ios_new</span>
            </a>
            <h1 class="text-lg font-bold text-gray-800">주변 맛집 전체보기</h1>
            <div class="w-6"></div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4 pb-24">
        <div id="restaurant-list-container" class="space-y-4">
        </div>
    </main>

    <script>
    (function () {
        const listContainer = document.getElementById('restaurant-list-container');
        
        // 로컬스트로지에 저장된 주변 식당 목록
        const savedData = localStorage.getItem('recommendedRestaurants');
        let restaurantsToDisplay = [];

        if (savedData) {
            try {
                restaurantsToDisplay = JSON.parse(savedData);
            } catch (e) {
                console.error("로컬 데이터 파싱 오류:", e);
            }
        } 
        
        // 데이터가 없을 경우 메시지 표시
        if (restaurantsToDisplay.length === 0) {
            listContainer.innerHTML = '<p class="text-gray-500 p-4">추천 맛집 정보가 없습니다. 홈 화면에서 오행 분석을 진행해 주세요.</p>';
            return;
        }

        listContainer.innerHTML = '';

        // 식당 카드 생성
        const renderRestaurantCard = (restaurant) => {
            const defaultImageUrl = '/assets/images/restaurant-default.png'; 
            let imageUrl = defaultImageUrl;

            // 이미지 처리 로직
            if (typeof restaurant.image === 'string' && restaurant.image.trim() !== '') {
                const images = restaurant.image.split(',').map(url => url.trim()).filter(url => url);
                if (images.length > 0) {
                    imageUrl = images[0];
                }
            }

            const ratingValue = restaurant.rating || 0; 
            const reviewCount = restaurant.review_count || 0;
            const locationText = restaurant.address || '주소 정보 없음';
            let statsHtml = '';

            // 평점/리뷰 조건부 생성 (평점이 있다면 평점과 리뷰 수를 표시, 평점이 없다면 리뷰 수만 표시)
            if (ratingValue > 0) {
                statsHtml = `
                    <div class="flex items-center text-sm text-gray-500 mt-1">
                        <span class="material-symbols-outlined text-yellow-500 text-base mr-1 fill-1">star</span>
                        <span class="font-semibold">${ratingValue.toFixed(1)}</span>
                        <span class="ml-2 text-gray-400">리뷰 ${reviewCount}개</span>
                    </div>
                `;
            } else {
                statsHtml = `
                    <div class="flex items-center text-sm text-gray-500 mt-1">
                        <span class="text-gray-400">리뷰 ${reviewCount}개</span>
                    </div>
                `;
            }

            return `
                <a href="detail.html?id=${restaurant.id}" class="flex bg-white p-3 rounded-xl shadow-sm hover:shadow-md transition-shadow">
                    
                    <div class="flex-shrink-0 w-24 rounded-lg overflow-hidden"> 
                        <img class="w-full h-full object-cover" src="${imageUrl}" alt="${restaurant.name}" onerror="this.onerror=null;this.src='${defaultImageUrl}';">
                    </div>

                    <div class="ml-4 flex-1 min-w-0">
                        <p class="text-xs text-orange-500 mb-1">${restaurant.distance_m}m 거리</p>
                        <h4 class="font-bold text-lg text-gray-800 truncate">${restaurant.name}</h4>
                        <p class="text-sm text-gray-500 truncate mt-1">${restaurant.category}</p>
                        
                        ${statsHtml}
                        
                        <p class="text-xs text-gray-400 mt-1 truncate">${locationText}</p>
                    </div>
                </a>
            `;
        };

        restaurantsToDisplay.forEach(restaurant => {
            listContainer.innerHTML += renderRestaurantCard(restaurant);
        });
    })();
    </script>
</body>

</html>