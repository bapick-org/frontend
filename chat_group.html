<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>밥픽 - 대화상대 선택</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fff;
        }

        .custom-checkbox {
            appearance: none;
            -webkit-appearance: none;
            border-radius: 9999px;
            border-width: 1px;
        }

        .custom-checkbox:checked {
            background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e");
            background-color: #FF7242;
            border-color: #FF7242;
        }

        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #FF7242;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="w-full h-screen flex flex-col">
        <header class="flex items-center justify-between p-4 border-b border-gray-200">
            <button onclick="history.back()">
                <svg class="w-6 h-6 text-gray-700" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <h1 class="text-lg font-bold">대화상대 선택</h1>
            <button id="confirm-btn" class="text-gray-400 font-semibold flex items-center gap-2" disabled>
                <span>확인</span>
                <div id="loading-spinner" class="spinner hidden"></div>
            </button>
        </header>

        <div id="group-name-section" class="hidden p-4 border-b border-gray-200 bg-orange-50">
            <label class="block text-sm font-medium text-gray-700 mb-2">단체채팅방 이름</label>
            <input 
                type="text" 
                id="group-name-input" 
                placeholder="단체채팅방 이름을 입력하세요 (선택사항)"
                class="w-full py-2 px-4 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400"
            >
            <p class="text-xs text-gray-500 mt-1">* 입력하지 않은 경우, 자동으로 멤버 이름으로 설정됩니다</p>
        </div>

        <div class="p-4 border-b border-gray-200">
            <div class="relative">
                <input type="text" id="friends-search-input" placeholder="닉네임으로 검색" 
                    class="w-full py-2 pl-10 pr-4 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400">
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                    <svg class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>
            <button id="add-friend-btn" class="w-full mt-2 py-2 text-gray-800 cursor-pointer hover:bg-gray-50 border-none bg-transparent flex items-center text-left text-base font-medium">
                <div class="w-9 h-9 rounded-full bg-orange-100 text-orange-500 flex justify-center items-center mr-3 flex-shrink-0">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 stroke-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                    </svg>
                </div>
                <span>새로운 친구 추가</span>
            </button>
        </div>

        <main id="friends-list" class="flex-1 overflow-y-auto p-4">
            <div class="flex justify-center items-center h-full">
                <div class="spinner" style="width: 40px; height: 40px; border-width: 3px;"></div>
            </div>
        </main>

        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-20 z-40 hidden transition-opacity"></div>

        <div id="add-friend-modal" class="fixed inset-0 bg-black bg-opacity-40 z-50 hidden items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm">

                <div class="p-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">친구 추가</h3>
                    <p class="text-gray-500 mb-4">추가할 친구의 닉네임을 검색하세요.</p>
                    <div class="relative">
                        <input id="friend-nickname-input" type="text" placeholder="친구 닉네임" class="w-full px-3 py-2 pr-10 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-400">
                    </div>
                    <div id="profile-list-container" class="mt-4 hidden space-y-2 max-h-48 overflow-y-auto">
                    </div>
                </div>

                <hr class="border-gray-200">
                <div class="p-6">
                    <h4 class="text-lg font-semibold text-gray-800 mb-3">받은 친구 요청</h4>
                    <div id="friend-request-list" class="space-y-3 max-h-48 overflow-y-auto">
                        <p id="no-requests-text" class="text-sm text-gray-500 hidden py-2">
                            받은 친구 요청이 없습니다.
                        </p>
                    </div>
                </div>

                <div class="bg-gray-50 px-6 py-3 flex justify-end rounded-b-lg">
                    <button id="cancel-add-friend-btn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-medium">
                        닫기
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { firebaseConfig } from "./firebase-config.js"; 

        // Firebase 앱 초기화
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const fastapiUrl = "https://bapick.duckdns.org"

        // UI 요소
        const overlay = document.getElementById('overlay');
        const addFriendBtn = document.getElementById('add-friend-btn');
        const addFriendModal = document.getElementById('add-friend-modal');
        const cancelAddFriendBtn = document.getElementById('cancel-add-friend-btn');
        const profileListContainer = document.getElementById('profile-list-container');
        const userSearchInput = document.getElementById('friend-nickname-input');
        const friendsListContainer = document.getElementById('friends-list');
        const friendsSearchInput = document.getElementById('friends-search-input');
        const confirmBtn = document.getElementById('confirm-btn');
        const groupNameSection = document.getElementById('group-name-section');
        const groupNameInput = document.getElementById('group-name-input');
        const loadingSpinner = document.getElementById('loading-spinner');
        const friendRequestList = document.getElementById('friend-request-list');
        const noRequestsText = document.getElementById('no-requests-text');

        let idToken = null;
        let currentUser = null;
        let allFriends = [];
        let selectedFriends = new Set();
        const defaultProfileImg = "assets/images/default-profile.png";

        /* =================================================================
        * 유틸리티 함수
        * ================================================================= */

        // API 호출 과부하를 방지하기 위한 디바운스 함수 (사용자 검색 input에서 사용)
        function debounce(func, delay) {
            let timeoutId;
            return function(...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        }
        
        /* =================================================================
        * 친구 관련 함수
        * ================================================================= */

        // 사용자 검색 결과 HTML 생성 - 사용자 프로필, 친구 요청 버튼
        function createUserSearchResult(user) {
            let buttonHtml = '';
            // 관계 상태(relation_status)에 따라 버튼 렌더링
            if (user.relation_status === "friend") {
                buttonHtml = `<span class="text-sm text-green-500 font-medium px-3 py-1 rounded-md bg-green-100">친구</span>`;
            } else if (user.relation_status === "sent_request") {
                buttonHtml = `<span class="text-sm text-gray-500 font-medium px-3 py-1 rounded-md bg-gray-100">요청 완료</span>`;
            } else if (user.relation_status === "received_request") {
                buttonHtml = `<span class="text-sm text-orange-500 font-medium px-3 py-1 rounded-md bg-orange-100">요청 받음</span>`; 
            } else {
                // 관계가 없는 경우 (친구 요청 버튼 표시)
                buttonHtml = `<button data-uid="${user.firebase_uid}" data-nickname="${user.nickname}"
                                    class="send-friend-request-btn text-sm text-white bg-orange-500 hover:bg-orange-600 px-3 py-1 rounded-md">
                                친구 요청
                            </button>`;
            }

            const profileItem = document.createElement('div');
            profileItem.className = "flex items-center justify-between p-2 rounded-lg bg-gray-50 hover:bg-gray-100 transition-colors";
            profileItem.innerHTML = `
                <div class="flex items-center space-x-3">
                    <img class="h-10 w-10 rounded-full object-cover"
                        src="${user.profile_image || defaultProfileImg}" alt="Profile">
                    <span class="font-medium text-gray-700">${user.nickname}</span>
                </div>
                <div class="flex-shrink-0">
                    ${buttonHtml}  
                </div>
            `;
            return profileItem;
        }

        // 사용자 검색 API 호출 및 검색 결과 렌더링 (Debounce 적용 대상)
        async function searchUsers(query) {
            profileListContainer.innerHTML = ''; 
            profileListContainer.classList.add('hidden');

            if (query.trim().length < 2) {
                profileListContainer.classList.remove('hidden');
                profileListContainer.innerHTML = '<p class="text-sm text-gray-500 p-2">검색어는 최소 두 글자 이상이어야 합니다.</p>';
                return;
            }
            
            try {
                const token = await currentUser.getIdToken();

                const res = await fetch(`${fastapiUrl}/api/friends/search?query=${encodeURIComponent(query)}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }

                const data = await res.json();
                const users = data.users || [];
                
                if (users.length > 0) {
                    users.forEach(user => {
                        profileListContainer.appendChild(createUserSearchResult(user));
                    });
                    profileListContainer.classList.remove('hidden');
                } else {
                    profileListContainer.classList.remove('hidden');
                    profileListContainer.innerHTML = '<p class="text-sm text-gray-500 p-2">검색 결과가 없습니다.</p>';
                }

                attachFriendRequestListeners(); // 새로 렌더링된 버튼에 이벤트 리스너 연결

            } catch (error) {
                console.error("사용자 검색 실패:", error);
                profileListContainer.classList.remove('hidden');
                profileListContainer.innerHTML = '<p class="text-sm text-red-500 p-2">검색 중 오류가 발생했습니다.</p>';
            }
        }

        // 친구 요청 전송 API 호출 및 버튼 상태 업데이트 
        async function sendFriendRequest(receiverUid, receiverNickname, buttonElement) {
            if (!confirm(`${receiverNickname}님께 친구 요청을 보내시겠습니까?`)) {
                return;
            }

            try {
                const token = await currentUser.getIdToken();

                // POST /friends/request (친구 요청 API) 호출
                const res = await fetch(`${fastapiUrl}/api/friends/request`, { 
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        to_user: receiverUid 
                    })
                });

                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(errorData.detail || `친구 요청 실패: ${res.status}`);
                }

                buttonElement.disabled = true;
                buttonElement.textContent = '요청 완료'; 
                buttonElement.classList.remove('bg-orange-500', 'hover:bg-orange-600', 'text-white');
                buttonElement.classList.add('bg-gray-100', 'text-gray-500', 'font-medium');
            } catch (error) {
                console.error("친구 요청 실패:", error);
                alert(`친구 요청 실패: ${error.message}`);
            }
        }

        // 검색 결과에 동적으로 생긴 '친구 요청' 버튼에 이벤트 리스너 연결
        function attachFriendRequestListeners() {
            document.querySelectorAll('.send-friend-request-btn').forEach(button => {
                if (!button.dataset.listenerAttached) {
                    button.addEventListener('click', async (event) => {
                        const btn = event.currentTarget;
                        const receiverUid = btn.getAttribute('data-uid');
                        const receiverNickname = btn.getAttribute('data-nickname');
                        await sendFriendRequest(receiverUid, receiverNickname, btn);
                    });
                    button.dataset.listenerAttached = 'true';
                }
            });
        }

        // 받은 친구 요청 렌더링
        function renderFriendRequest(req) {
            const item = document.createElement('div');
            item.className = "flex items-center justify-between p-2 rounded-lg bg-gray-50";
            item.dataset.requesterUid = req.from_user_uid;

            item.innerHTML = `
                <div class="flex items-center space-x-3">
                    <img class="h-10 w-10 rounded-full object-cover"
                        src="${req.from_user_profile_image || defaultProfileImg}" alt="Profile">
                    <span class="font-medium text-gray-700">${req.from_user_nickname}</span>
                </div>
                <div class="space-x-2 flex-shrink-0">
                    <button data-action="accept" data-requester-uid="${req.from_user_uid}" 
                            class="handle-request-btn text-sm text-white bg-blue-500 hover:bg-blue-600 px-3 py-1 rounded-md">수락</button>
                    <button data-action="reject" data-requester-uid="${req.from_user_uid}"
                            class="handle-request-btn text-sm text-white bg-red-500 hover:bg-red-600 px-3 py-1 rounded-md">거절</button>
                </div>
            `;
            return item;
        }

        // 받은 친구 요청 조회 API 호출
        async function loadFriendRequests() {
            friendRequestList.innerHTML = '<p class="text-sm text-gray-500 py-2">친구 요청을 불러오는 중...</p>';
            if (!currentUser) return;

            try {
                const token = await currentUser.getIdToken();
                const res = await fetch(`${fastapiUrl}/api/friends/requests`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!res.ok) {
                    throw new Error(`HTTP error! status: ${res.status}`);
                }
                
                const data = await res.json();
                const requests = data.requests || [];

                friendRequestList.innerHTML = '';
                
                if (requests.length === 0) {
                    noRequestsText.classList.remove('hidden');
                    friendRequestList.appendChild(noRequestsText);
                } else {
                    noRequestsText.classList.add('hidden');
                    requests.forEach(req => {
                        friendRequestList.appendChild(renderFriendRequest(req));
                    });
                }
                attachRequestHandleListeners(); // 요청 처리 버튼에 이벤트 연결

            } catch (error) {
                console.error("친구 요청 목록 로드 실패:", error);
                friendRequestList.innerHTML = '<p class="text-sm text-red-500 p-2">친구 요청 로드 중 오류 발생</p>';
            }
        }

        // 친구 요청 수락/거절 API 호출
        async function handleFriendRequest(requesterUid, action, buttonElement) {
            if (!currentUser) return;
            try {
                const token = await currentUser.getIdToken();
                const res = await fetch(`${fastapiUrl}/api/friends/handle`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        requester_uid: requesterUid,
                        action: action 
                    })
                });

                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(errorData.detail || `요청 처리 실패: ${res.status}`);
                }
                
                alert(action === 'accept' ? '친구가 되었습니다!' : '요청을 거절했습니다.');
                
                // 친구 요청 목록을 다시 로드
                loadFriendRequests(); 

            } catch (error) {
                console.error(`요청 처리 실패 (${action}):`, error);
                alert(`요청 처리 실패: ${error.message}`);
                buttonElement.disabled = false;
                buttonElement.textContent = action === 'accept' ? '수락' : '거절';
            }
        }

        // 받은 친구 요청에 동적으로 생성된 요청 처리(요청 수락/거절) 버튼에 이벤트 리스너 연결
        function attachRequestHandleListeners() {
            document.querySelectorAll('.handle-request-btn').forEach(button => {
                if (!button.dataset.listenerAttached) {
                    button.addEventListener('click', async (event) => {
                        const btn = event.currentTarget;
                        const requesterUid = btn.getAttribute('data-requester-uid');
                        const action = btn.getAttribute('data-action');
                        await handleFriendRequest(requesterUid, action, btn);
                    });
                    button.dataset.listenerAttached = 'true';
                }
            });
        }


        /* =================================================================
        * 단체 채팅방 생성 
        * ================================================================= */
        // 친구 목록 조회
        async function loadFriends() {
            try {
                const res = await fetch(`${fastapiUrl}/api/friends/list`, {
                    headers: { "Authorization": `Bearer ${idToken}` }
                });

                if (!res.ok) throw new Error('친구 목록 로드 실패');

                const data = await res.json(); 

                // API 응답이 배열인지 객체인지 확인
                if (Array.isArray(data)) {
                    allFriends = data;
                } else if (data.friends && Array.isArray(data.friends)) {
                    allFriends = data.friends;
                } else {
                    allFriends = [];
                }
                
                renderFriends(allFriends);
            } catch (err) {
                console.error('친구 목록 로드 오류:', err);
                friendsListContainer.innerHTML = `
                    <div class="text-center text-red-500 mt-4">
                        <p>친구 목록을 불러올 수 없습니다. 서버 상태를 확인하세요.</p>
                        <button onclick="location.reload()" class="mt-2 text-orange-500 underline">다시 시도</button>
                    </div>
                `;
            }
        }

        // 친구 목록 렌더링
        function renderFriends(friends) {
            friendsListContainer.innerHTML = '';
            
            if (friends.length === 0) {
                friendsListContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">친구가 없습니다.</p>';
                return;
            }

            friends.forEach(friend => {
                const friendElement = document.createElement('label');
                friendElement.className = 'flex items-center p-2 rounded-lg hover:bg-gray-50 cursor-pointer';
                
                const profileImg = friend.profile_image || defaultProfileImg;
                
                friendElement.innerHTML = `
                    <img src="${profileImg}" class="w-10 h-10 rounded-full mr-4 object-cover" alt="${friend.nickname}">
                    <span class="flex-1 text-gray-800">${friend.nickname}</span>
                    <input type="checkbox" class="custom-checkbox w-5 h-5 border-gray-300 focus:ring-transparent" data-uid="${friend.firebase_uid}" ${selectedFriends.has(friend.firebase_uid) ? 'checked' : ''}>
                `;
                friendsListContainer.appendChild(friendElement);
            });
        }

        //선택된 친구 수에 따라 '확인' 버튼과 단체채팅방 이름 입력 UI 업데이트
        function updateConfirmButton() {
            const count = selectedFriends.size;
            
            if (count > 0) {
                confirmBtn.disabled = false;
                confirmBtn.querySelector('span').textContent = `확인 (${count})`;
                confirmBtn.classList.remove('text-gray-400');
                confirmBtn.classList.add('text-orange-500');
                
                // 1명 이상 선택 시 단체채팅방 이름 입력 섹션 표시
                groupNameSection.classList.remove('hidden');
            } else {
                confirmBtn.disabled = true;
                confirmBtn.querySelector('span').textContent = '확인';
                confirmBtn.classList.add('text-gray-400');
                confirmBtn.classList.remove('text-orange-500');
                groupNameSection.classList.add('hidden');
            }
        }

        // 단체 채팅방 생성 후 이동
        confirmBtn.addEventListener('click', async () => {
            if (selectedFriends.size === 0) return;

            // 로딩 상태
            confirmBtn.disabled = true;
            loadingSpinner.classList.remove('hidden');
            confirmBtn.querySelector('span').textContent = '생성 중';

            try {
                const groupName = groupNameInput.value.trim() || null;
                const invitedUids = Array.from(selectedFriends);

                const res = await fetch(`${fastapiUrl}/api/chat/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${idToken}`
                    },
                    body: JSON.stringify({
                        name: groupName,
                        is_group: invitedUids.length >= 1, 
                        invited_uids: invitedUids
                    })
                });

                if (!res.ok) {
                    const errorData = await res.json();
                    throw new Error(errorData.detail || '채팅방 생성 실패');
                }

                const data = await res.json();
                
                // 생성된 채팅방으로 이동 (data.chatroom_id 필요)
                window.location.href = `chat.html?roomId=${data.chatroom_id}`;

            } catch (err) {
                console.error('채팅방 생성 오류:', err);
                alert(`채팅방 생성 실패: ${err.message}`);
                
                // 로딩 해제
                loadingSpinner.classList.add('hidden');
                updateConfirmButton(); // 버튼 텍스트와 disabled 상태 복구
            }
        });

        /* =================================================================
        * 이벤트 리스너 설정 및 초기화 
        * ================================================================= */
        // 로그인 상태 확인 및 초기화
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                idToken = await user.getIdToken();
                await loadFriends();
            } else {
                alert('로그인이 필요합니다.');
                window.location.href = 'index.html'; // 로그인 페이지로 이동
                return;
            }
        });
        
        // DOMContentLoaded 이벤트 리스너
        document.addEventListener('DOMContentLoaded', () => {
            // 친구 검색 input 디바운스 적용
            const debouncedSearch = debounce(searchUsers, 300);

            // 1) 친구 검색 input 이벤트
            if (userSearchInput) {
                userSearchInput.addEventListener('input', (event) => {
                    const query = event.target.value;
                    if (query.trim() === '') {
                        profileListContainer.innerHTML = '';
                        profileListContainer.classList.add('hidden');
                    } else {
                        debouncedSearch(query);
                    }
                });
            }

            // 3) 친구 추가 모달 열기 버튼 이벤트
            addFriendBtn.addEventListener('click', () => {
                addFriendModal.classList.remove('hidden');
                addFriendModal.classList.add('flex');
                loadFriendRequests(); // 받은 친구 요청 목록 로드
            });

            // 4) 친구 추가 모달 닫기 버튼 이벤트
            cancelAddFriendBtn.addEventListener('click', () => {
                addFriendModal.classList.add('hidden');
                addFriendModal.classList.remove('flex');

                // 모달 닫을 때 검색 결과 및 입력 필드 초기화
                userSearchInput.value = '';
                profileListContainer.innerHTML = '';
                profileListContainer.classList.add('hidden');
            });
        });

        // 친구 검색 인풋 이벤트
        friendsSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredFriends = allFriends.filter(friend => 
                friend.nickname.toLowerCase().includes(searchTerm)
            );
            renderFriends(filteredFriends);
        });

        // 친구 목록에서 체크박스 이벤트 핸들러
        friendsListContainer.addEventListener('change', (e) => {
            if (e.target.type === 'checkbox') {
                const friendUid = e.target.dataset.uid;
                if (e.target.checked) {
                    selectedFriends.add(friendUid);
                } else {
                    selectedFriends.delete(friendUid);
                }
                updateConfirmButton();
                const searchTerm = friendsSearchInput.value.toLowerCase();
                const filteredFriends = allFriends.filter(friend => 
                    friend.nickname.toLowerCase().includes(searchTerm)
                );
                renderFriends(filteredFriends);
            }
        });
    </script>
</body>
</html>